# Ch14. Testability

## TL;DR
- **테스트 가능한 설계는 좋은 설계다**. 테스트하기 어렵다면 설계에 문제가 있다는 신호다.
- TDD는 단순한 테스트 기법이 아니라 **설계를 이끄는 방법**이다.
- **테스트 피라미드**: 단위 테스트(많이) > 통합 테스트(적당히) > E2E 테스트(적게).
- 포트와 어댑터 아키텍처는 테스트 가능성을 극대화한다. 비즈니스 로직을 외부 의존성 없이 테스트할 수 있다.

## Key Ideas
- **테스트 가능성 = 설계 품질 지표**: 테스트하려면 명확한 입출력, 낮은 결합도, 높은 응집도가 필요하다. 이것들은 좋은 설계의 특성이기도 하다.
- **TDD의 3단계**: Red(실패하는 테스트 작성) → Green(최소한의 구현) → Refactor(코드 개선). 이 사이클이 설계를 점진적으로 개선한다.
- **테스트 더블**: Stub(고정 응답 반환), Mock(호출 검증), Fake(간단한 구현). 외부 의존성을 대체하여 테스트를 빠르고 안정적으로 만든다.
- **테스트 피라미드**: 빠르고 안정적인 단위 테스트를 많이, 느리고 불안정한 E2E 테스트를 적게. 역삼각형(E2E 위주)은 안티패턴이다.
- **속성 기반 테스트**: 특정 입출력 대신 "항상 참이어야 하는 속성"을 테스트한다. 예상치 못한 케이스를 발견하는 데 유용하다.

## Trade-offs

| 선택 | 장점 | 단점 | 언제 |
|-----|-----|-----|-----|
| TDD | 높은 커버리지, 설계 개선 | 학습 곡선, 초기 속도 감소 | 복잡한 비즈니스 로직 |
| 테스트 후행 | 빠른 초기 개발 | 테스트 불가능한 설계 위험 | 탐색적 프로토타입 |
| 단위 테스트 위주 | 빠름, 안정적 | 통합 문제 미발견 | 로직 중심 코드 |
| E2E 테스트 위주 | 현실적 시나리오 | 느림, 불안정 | 최소한만, 핵심 흐름 |

## Open Questions
- 현재 테스트 피라미드의 모양이 어떤가? 이상적인 피라미드에 가까운가?
- 테스트하기 어려운 코드가 있다면, 그것은 어떤 설계 문제를 나타내는가?
