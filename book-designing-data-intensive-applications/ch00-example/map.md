# Reliability, Scalability, Maintainability

## TL;DR (3 sentences)
- 품질은 **신뢰성·확장성·유지보수성**의 균형이다. 평균이 아니라 **p95/p99**와 **에러율**로 본다.
- 신뢰성은 장애(fault)가 사용자 실패로 번역되지 않도록 **중복·재시도·멱등성·격리**를 설계하는 일이다.
- 확장성은 부하 변화에 대한 체계적 대응(캐시·큐·샤딩·비동기화), 유지보수성은 **관측성·단순성·진화 가능성**을 높이는 것이다.

## Key Ideas (8)
- **SLO/SLI**로 목표를 수치화: 예) `p95 < 200ms`, `에러율 < 0.1%`, `가용성 99.9%`.
- **Tail latency** 관리가 체감 품질을 좌우한다(p95/p99). 평균은 오도한다.
- **재시도는 멱등성(Idempotency)** 과 세트다. 재시도/타임아웃/서킷브레이커/백오프는 패키지로 설계한다.
- **큐(버퍼)** 로 스파이크를 흡수하되, 지연·순서·재처리를 함께 관리한다.
- **캐시** 는 레이턴시와 비용을 줄이지만, **무효화·일관성** 문제가 생긴다(Aside/Through/Write-back 비교).
- **단순성**: 핵심 경로를 짧게, 실패 모드를 명시하고 기본값/디그레이드 경로를 둔다.
- **관측성**: RED/USE, 분산 트레이싱, 샘플링/상관관계로 “어디가 느린가/깨졌는가”를 즉시 보이게 한다.
- **릴리즈 전략**: 카나리/블루그린/피처플래그로 **점진적 위험 완화**와 **즉시 롤백** 통로 확보.

## Typical Trade-offs
| 선택 | 장점 | 단점 | 언제 |
|---|---|---|---|
| 캐시 Aside | 단순, 앱 통제 쉬움 | miss 스파이크, 스탬피드 | 읽기 많은 키, TTL 명확 |
| Read-through | 일관된 코드, 프록시 집중 | 캐시 장애 시 병목 | 표준화된 캐시 계층 |
| 동기 처리 | 단순/일관성 | 지연↑, 장애 전파 | 강한 즉시성 필요 |
| 비동기+큐 | 지연 분리, 스파이크 흡수 | 지연/재처리 설계 필요 | 쓰기 폭주/피크 대응 |

## Apply to My Domain (Orders/Dispatch)
- `GET /orders/{id}`: **Cache-Aside + TTL 5m**으로 p95를 `220→150ms`. 스탬피드 방지는 **분산락/정체 키 백오프** 적용.
- `POST /orders`: **Outbox + 멱등키**(orderId)로 재시도 안전화. DLQ/리플레이 경로 설계.
- 알림/후처리 이벤트는 큐로 분리해 **핵심 경로 레이턴시** 보호.

## Metrics & SLO
- **SLI**: p50/p95/p99, 에러율(5xx+타임아웃), 큐 적재/대기 시간, 캐시 hit, 재시도율, DLQ 수.
- **SLO**: `p95 < 200ms`, `에러율 < 0.1%`, `큐 대기 < 500ms`, `DLQ < 0.01%`.

## Open Questions
- 캐시 TTL과 데이터 신선도 요구를 어떻게 수치로 조율할까?
- 재시도 정책의 **최대 증폭**(retry amplification) 상한은?
- p99 개선과 비용(오토스케일/프리웜)의 경계는 어디인가?
