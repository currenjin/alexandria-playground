# Ch02. 마이크로서비스 모델링 방법

## TL;DR
- 도메인을 자세히 이해하는 것은 낮은 결합도와 강한 응집력, 문제 영역에서의 경계를 찾는 데 도움이 된다.
- 올바른 마이크로서비스의 경계를 만드는 것은 정보 은닉, 높은 응집력, 낮은 결합도이다.
- 하나의 애그리거트는 하나의 마이크로서비스에서 관리돼야 한다.

## Key Ideas
- 정보 은닉(Information Hiding): 모듈 경계 뒤에 가능한 많은 세부 정보를 숨기려는 욕구
- 도메인 결합(Domain Coupling): 한 마이크로서비스가 다른 마이크로서비스와 상호작용
- 통과 결합(Pass-Through Coupling): 한 마이크로서비스가 다른 마이크로서비스에 데이터를 전달. 이 경우, 하위 서비스와 직접 통신
- 공통 결합(Common Coupling): 둘 이상의 마이크로서비스가 공통 데이터 집합을 사용. 이 경우, 한 서비스가 온전히 책임을 지도록 해야함
- 내용 결합(Content Coupling): 상위 서비스가 하위 서비스 내부까지 도달해 서비스 내부 상태를 변경. 이 경우, 직접 요청을 보내도록 해야함

## Open Questions
- 모든 결합은 나쁜가?
  - 결합은 필연적이고, 불필요한 결합을 줄이고 필요한 결합을 느슨하게 유지하는 것이다.
  - 좋은 결합의 조건
    - 비즈니스적으로 필수
    - 안정적인 컨트랙트위에서 이뤄짐
    - 시간적 독립성 보장
  - 나쁜 결합의 신호
    - 다른 서비스의 내부 스키마/컬럼에 의존
    - 공통 DB 쓰기로 배포 독립성 상실
    - 동기 체인으로 SLO가 전파됨
- 내용 결합은 주로 어떤 상황에서 발생하는가?
  - 공유 DB 및 스키마를 여러 서비스가 직접 조회 및 갱신할 때
  - 다른 서비스의 내부 엔터티를 DTO처럼 재사용할 때
  - GraphQL/REST 응답을 내부 모델 그대로 노출해 외부가 내부 필드에 묶일 때 -> 외부에는 전용 DTO만 노출
  - 빠르게 붙이자는 이유로 ACL 없이 타 서비스의 내부 API를 그대로 소비할 때 -> 외부, 내부 도메인 변환 계층
