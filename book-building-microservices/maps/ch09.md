# Ch09. 테스트

## TL;DR
- 빠른 피드백을 위해 취적화하고 테스트 타입을 적절히 분리하라.
- 둘 이상의 팀에 걸쳐있는 E2E 테스트의 필요성을 줄여라. 대신 소비자 주도 계약을 고려하라. 소비자 주도 계약을 통해 팀 간 대화의 초점을 제공하자.
- 테스트에 더 많은 노력을 기울이는 것과 운영 환경에서 문제를 더 빨리 감지하는 것 같의 절충점을 이해하려고 노력하라.
- 운영 환경에서 테스트하라.
- 평균 무고장 시간(Mean Time Between Failures)의 최적화와 평균 수리 시간(Mean Time to Repair)의 최적화 간 균형점을 고려하자.

## Key Ideas
- 마이크 콘의 테스트 피라미드: 피라미드 위로 올라갈 수록 테스트의 범위는 증가하고, 테스트 중인 기능이 작동한다는 확신도 커진다. 반면에, 테스트를 실행하는 데 오랜 시간이 걸리면 피드백 주기 시간이 늘어나고, 테스트가 실패하면 어떤 기능이 손상됐는지 확인하기 더 어려워질 수 있다. 피라미드 아래로 내려가면, 이의 반대다.
- Unit Test: 단일 함수 또는 메서드 호출을 테스트한다.
- Service Test: 사용자 인터페이스를 우회하고 서비스를 직접 테스트하도록 설계됐다.
- E2E Test: 시스템 전체에 대해 수행한다. 단, 범위가 증가함에 따라 구성 요소 수 역시 증가하고, 구성 요소가 많을 수록 테스트는 더 불안정해진다.
- 소비자 주도 테스트(소비자 주도 계약 & 계약 테스트)은 마이크로서비스의 작동 방식에 대한 기대치를 테스트하고, 이에 대해 외부 종속성이 제거된 고객 서비스만 실행하면 된다. 팀의 누군가가 협력해 테스트를 생성하도록 하는 것도 좋다. ([Pact](https://pact.io/), [Contract](https://spring.io/projects/spring-cloud-contract))
- 운영환경 테스트를 통해 높은 품질의 피드백을 받자. 헬스 체크도 한 예가 되고, 스모크 테스트와 카나리아 릴리즈, 가짜 사용자 행동을 주입 등을 고려할 수 있다.
- 평균 무고장 시간(Mean Time Between Failures)의 최적화와 평균 수리 시간(Mean Time to Repair)의 최적화 간 균형점을 고려하자.

## Open Questions
- 프론트엔드에서의 테스트는 어떻게 진행하면 좋을까?
- 조직의 문화로 테스트를 자리잡게 하기 위해서는 어떤 것을 하면 좋을까?
- 우리에게 필요한 엔드투엔드 테스트는 무엇이 있을까? 그 중 꼭 필요한 건 무엇인가?
- 우리 서비스에 소비자 주도 테스트를 적용한다면 어떤 모습일까?
  - 현재 개발 프로세스는 다음과 같다.
    1. 기획/디자인 리뷰 및 이벤트 스토밍
    2. 이벤트에 따른 API 리스트업
    3. 백엔드 개발자는 Dummy API 작업 및 restDocs 테스트 추가
    4. 프론트엔드 개발자는 해당 문서를 보고 작업, 테스트 진행
    5. 실제 API 구현
  - 위 프로세스에서 봤을 때, 소비자 주도 테스트를 진행하고 있다 생각한다. 클라이언트와 서버 간 계약을 기준으로 소통 및 작업을 진행하는 맥락으로는 동일하기 때문이다.
  - 위 프로세스로 변경 후 front-end 개발자의 만족도와 생산성이 올라갔고, back-end 개발자 또한 별도 문서 작업 없이 restDocs로 문서 생성 및 테스트가 완료되어 생산성이 향상된다.
- 우리 서비스의 MTBF, MTTR은 얼마나 되는가? 그 균형은 잘 유지되고 있는가?