# Ch10. 모니터링에서 관찰가능성으로

## TL;DR
- 시스템 또는 마이크로서비스 상태를 '행복' 또는 '슬픔' 로 이해하는 이분법적인 상태에서 벗어나, 진실은 항상 그보다 더 미묘한 차이가 있다는 것을 인식하라.
- 알림 피로를 줄이고 SLO를 수용해 이 원칙에 따라 알림을 보내기를 적극 고려하라.
- 관찰가능성을 위해서는 로그, 메트릭, 분산 추적, 알림 등을 필수적으로 적용하라.

## Key Ideas
- 로그 집계: 여러 마이크로서비스에서 정보를 수집하는 것으로, 모든 모니터링이나 관찰가능성 솔루션의 중요한 구성 요소다.
  - 로그 날짜, 시간, 서비스 이름, 로그 레벨 등이 각 로그의 일관된 위치에 있어야 한다.
  - Fluentd, Elasticsearch, Kibana, Humio, Datadog
- 메트릭 집계: 마이크로서비스와 인프라스트럭쳐에서 원시 수치를 캡처해 문제를 탐지하고, 용량 계획을 추진하며, 애플리케이션 확장까지 할 수 있다.
  - 카디널리티는 주어진 데이터 포인트에서 쉽게 쿼리할 수 있는 필드의 수이다. 쿼리하려는 필드가 많을수록 지원해야 하는 카디널리티는 높아진다. 이는 시계열 데이터베이스에서 더욱 문제가 된다.
  - Prometheus
- 분산 추적: 무엇이 잘못됐는지 파악하고 정확한 지연 시간 정보를 도출하기 위해 여러 마이크로서비스 경계에서 호출 흐름을 추적한다.
  - 대부분 유사한 방식으로 동작한다. 1) 스레드의 로컬 활동은 스팬으로 캡처된다. 2) 각 스팬은 고유 식별자를 사용해 연결되며, 3) 트레이스로 구성되도록 중앙 수집기로 전송된다.
  - OpenTracking API, Dapper, Jaeger, OpenTracing, Open Telemetry API
- 지금 괜찮은가?: 에러 예산, SLA, SLO 등을 살펴보고, 마이크로서비스가 소비자의 요구 사항을 충족하는지 확인하는 과정의 일부로 사용할 수 있는 방법을 확인한다.
  - 한 마리의 벌이 행복하지 않다고 모든 벌이 행복하지 않은 것은 아니다. 양호한 CPU 레벨은 무엇인지 또는 허용 가능한 응답 시간을 만드는 요소는 무엇인지 등을 결정해 서비스가 정상인지 알아낼 수 있다.  
  - Service-Level Agreement: 시스템을 구축하는 사람과 시스템을 사용하는 사람 사이의 계약이다. 사용자가 기대하는 것뿐만 아니라 허용 가능한 동작 수준에 도달하지 못할 경우 발생하는 상황도 해당한다.
  - Service-Level Objective: 팀 수준에서 계약하는 것을 정의한다. 예상 가동 시간이나 지정된 연산에 대한 허용 가능한 응답 시간과 같은 항목이 해당한다.
  - Service-Level Indicator: 소프트웨어가 수행하는 작업의 척도다. 특정 프로세스의 응답 시간, 등록 중인 고객, 고객에게 제기된 오류 또는 진행 중인 주문이 될 수 있다.
- 알림: 무엇을 알려야 할까? 좋은 알림이란 어떤 것일까?
- 시멘틱 모니터링: 시스템의 상태와 새벽 3시에 우리를 깨워야 하는 것에 대해 다른 방식으로 생각한다.
- 운영 환경에서 테스트: 운영 환경의 다양한 테스트 기법에 대한 요약

## Open Questions
- 우리의 SLA, SLO, SLI는 무엇으로 기준을 세우고, 그 수치는 얼마나 되는가?
- 우리가 사용하는 로그와 메트릭 집계 툴은 어떤 것이 있으며, 각각 어떻게 동작하는가?
